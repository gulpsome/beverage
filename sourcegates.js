// Generated by CoffeeScript 1.9.1
var R, fs, get, getPreset, nocomments, path, sourcegate;

require("source-map-support").install();

R = require("ramda");

fs = require("fs");

path = require("path");

sourcegate = require("sourcegate");

nocomments = require("strip-json-comments");

get = function(what, module) {
  var e, where;
  where = ["node_modules/" + what, "node_modules/" + module + "/node_modules/" + what];
  try {
    return JSON.parse(nocomments(fs.readFileSync(path.normalize(where[0])).toString()));
  } catch (_error) {
    try {
      return JSON.parse(nocomments(fs.readFileSync(path.normalize(where[1])).toString()));
    } catch (_error) {
      e = _error;
      console.error(e);
      throw new Error("Could not find preset at: " + where);
    }
  }
};

getPreset = function(tool, name, module) {
  var presets, ref;
  presets = {
    jscs: "jscs/presets",
    jshint: {
      airbnb: "airbnb-style/linters/jshintrc"
    },
    eslint: {
      airbnb: "airbnb-style/linters/eslintrc"
    }
  };
  if (tool === "jscs") {
    return get(presets.jscs + "/" + name + ".json", module);
  } else if (((ref = presets[tool]) != null ? ref[name] : void 0) != null) {
    return get(presets[tool][name], module);
  } else {
    return {};
  }
};

module.exports = function(o, gulp) {
  var base, config, empty, i, len, module, prefix, preset, ready, ref, ref1, res, sg, sources, watch;
  if (o == null) {
    o = {};
  }
  empty = [[], {}];
  if (R.is(Array, o.sourcegate)) {
    if (R.isEmpty(o.sourcegate)) {
      return [empty];
    }
  } else {
    return [empty];
  }
  ready = [];
  watch = [];
  ref = o.sourcegate;
  for (i = 0, len = ref.length; i < len; i++) {
    sg = ref[i];
    res = R.clone(empty);
    if (sg.sources == null) {
      sg.sources = ((ref1 = o.sourcegateRx) != null ? ref1[sg.recipe] : void 0) || [];
    } else if (!R.is(Array, sg.sources)) {
      sg.sources = [sg.sources];
    }
    if (sg.options == null) {
      sg.options = {};
    }
    if (sg.recipe == null) {
      res = [sg.sources, sg.options];
    } else {
      sources = [];
      config = "node_modules";
      module = sg.module || o.sourcegateModule;
      prefix = sg.prefix || o.sourcegatePrefix || '';
      preset = sg.preset || o.sourcegatePreset;
      if (module) {
        if (preset != null) {
          sources.push(getPreset(sg.recipe, preset, module));
        }
        config = path.normalize(config + "/" + module + "/" + prefix + sg.recipe + "rc");
        if (fs.existsSync(config)) {
          if (o.sourcegateWatch) {
            watch.push(config);
          }
          sources.push(config);
        }
        if ((base = sg.options).write == null) {
          base.write = {};
        }
        sg.options.write.path = "." + sg.recipe + "rc";
      }
      res = [sources.concat(sg.sources), sg.options];
    }
    ready.push(res);
  }
  if (gulp != null) {
    gulp.task("sourcegate", "Write sourcegate targets.", function() {
      var j, len1, results;
      results = [];
      for (j = 0, len1 = ready.length; j < len1; j++) {
        sg = ready[j];
        results.push(sourcegate.apply(null, sg));
      }
      return results;
    });
    if (o.sourcegateWatch) {
      gulp.task("sourcegate:watch", "Watch sourcegate sources for changes.", function() {
        return gulp.watch(watch, ["sourcegate"]);
      });
    }
  }
  return ready;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNlZ2F0ZXMuY29mZmVlIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic291cmNlZ2F0ZXMuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFHQSxJQUFBLG1EQUFBOztBQUFBLE9BQUEsQ0FBUSxvQkFBUixDQUE2QixDQUFDLE9BQTlCLENBQUEsQ0FBQSxDQUFBOztBQUFBLENBQ0EsR0FBSSxPQUFBLENBQVEsT0FBUixDQURKLENBQUE7O0FBQUEsRUFFQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBRkwsQ0FBQTs7QUFBQSxJQUdBLEdBQU8sT0FBQSxDQUFRLE1BQVIsQ0FIUCxDQUFBOztBQUFBLFVBSUEsR0FBYSxPQUFBLENBQVEsWUFBUixDQUpiLENBQUE7O0FBQUEsVUFLQSxHQUFhLE9BQUEsQ0FBUSxxQkFBUixDQUxiLENBQUE7O0FBQUEsR0FRQSxHQUFNLFNBQUMsSUFBRCxFQUFPLE1BQVAsR0FBQTtBQUNKLE1BQUEsUUFBQTtBQUFBLEVBQUEsS0FBQSxHQUFRLENBQ04sZUFBQSxHQUFnQixJQURWLEVBRU4sZUFBQSxHQUFnQixNQUFoQixHQUF1QixnQkFBdkIsR0FBdUMsSUFGakMsQ0FBUixDQUFBO0FBS0E7V0FDRSxJQUFJLENBQUMsS0FBTCxDQUFXLFVBQUEsQ0FBVyxFQUFFLENBQUMsWUFBSCxDQUFnQixJQUFJLENBQUMsU0FBTCxDQUFlLEtBQU0sQ0FBQSxDQUFBLENBQXJCLENBQWhCLENBQXdDLENBQUMsUUFBekMsQ0FBQSxDQUFYLENBQVgsRUFERjtHQUFBLGNBQUE7QUFHRTthQUNFLElBQUksQ0FBQyxLQUFMLENBQVcsVUFBQSxDQUFXLEVBQUUsQ0FBQyxZQUFILENBQWdCLElBQUksQ0FBQyxTQUFMLENBQWUsS0FBTSxDQUFBLENBQUEsQ0FBckIsQ0FBaEIsQ0FBd0MsQ0FBQyxRQUF6QyxDQUFBLENBQVgsQ0FBWCxFQURGO0tBQUEsY0FBQTtBQUdFLE1BREksVUFDSixDQUFBO0FBQUEsTUFBQSxPQUFPLENBQUMsS0FBUixD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QUN2QyxJQUFJLENBQUMsS0FBTCxDQUFXLEtBQVgsRUFBa0IsQ0FBQyxZQUFELENBQWxCLEVBRHVDO01BQUEsQ0FEM0MsQ0FBQSxDQURGO0tBSkY7R0F0Q0E7U0ErQ0EsTUFoRGU7QUFBQSxDQXZDakIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIiMgVE9ETzogdGhpcyBtb2R1bGUgc2hvdWxkIGJlY29tZSBpdHMgb3duIHByb2plY3QsIG9ybGluL2hhbC1yYz9cbiMgYXMgZ3VscCBpcyBvcHRpb25hbCwgZG9jdW1lbnQgd2hpY2ggb3B0aW9ucyBhcmUgZ3VscC1zcGVjaWZpY1xuXG5yZXF1aXJlKFwic291cmNlLW1hcC1zdXBwb3J0XCIpLmluc3RhbGwoKVxuUiA9IHJlcXVpcmUoXCJyYW1kYVwiKVxuZnMgPSByZXF1aXJlKFwiZnNcIilcbnBhdGggPSByZXF1aXJlKFwicGF0aFwiKVxuc291cmNlZ2F0ZSA9IHJlcXVpcmUoXCJzb3VyY2VnYXRlXCIpXG5ub2NvbW1lbnRzID0gcmVxdWlyZShcInN0cmlwLWpzb24tY29tbWVudHNcIilcblxuXG5nZXQgPSAod2hhdCwgbW9kdWxlKSAtPlxuICB3aGVyZSA9IFtcbiAgICBcIm5vZGVfbW9kdWxlcy8je3doYXR9XCIsXG4gICAgXCJub2RlX21vZHVsZXMvI3ttb2R1bGV9L25vZGVfbW9kdWxlcy8je3doYXR9XCJcbiAgXVxuXG4gIHRyeVxuICAgIEpTT04ucGFyc2Ugbm9jb21tZW50cyBmcy5yZWFkRmlsZVN5bmMocGF0aC5ub3JtYWxpemUgd2hlcmVbMF0pLnRvU3RyaW5nKClcbiAgY2F0Y2hcbiAgICB0cnlcbiAgICAgIEpTT04ucGFyc2Ugbm9jb21tZW50cyBmcy5yZWFkRmlsZVN5bmMocGF0aC5ub3JtYWxpemUgd2hlcmVbMV0pLnRvU3RyaW5nKClcbiAgICBjYXRjaCBlXG4gICAgICBjb25zb2xlLmVycm9yKGUpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJDb3VsZCBub3QgZmluZCBwcmVzZXQgYXQ6ICN7d2hlcmV9XCJcblxuXG5nZXRQcmVzZXQgPSAodG9vbCwgbmFtZSwgbW9kdWxlKSAtPlxuICBwcmVzZXRzID1cbiAgICBqc2NzOiBcImpzY3MvcHJlc2V0c1wiICN7cHJlc2V0fS5qc29uIHdpbGwgYmUgYXBwZW5kZWRcbiAgICBqc2hpbnQ6XG4gICAgICBhaXJibmI6IFwiYWlyYm5iLXN0eWxlL2xpbnRlcnMvanNoaW50cmNcIlxuICAgIGVzbGludDpcbiAgICAgIGFpcmJuYjogXCJhaXJibmItc3R5bGUvbGludGVycy9lc2xpbnRyY1wiXG5cbiAgaWYgdG9vbCBpcyBcImpzY3NcIlxuICAgIGdldChcIiN7cHJlc2V0cy5qc2NzfS8je25hbWV9Lmpzb25cIiwgbW9kdWxlKVxuICBlbHNlIGlmIHByZXNldHNbdG9vbF0/W25hbWVdP1xuICAgIGdldChwcmVzZXRzW3Rvb2xdW25hbWVdLCBtb2R1bGUpXG4gIGVsc2Uge31cblxuXG5tb2R1bGUuZXhwb3J0cyA9IChvID0ge30sIGd1bHApIC0+XG4gIGVtcHR5ID0gW1tdLCB7fV1cbiAgaWYgUi5pcyhBcnJheSwgby5zb3VyY2VnYXRlKVxuICAgIGlmIFIuaXNFbXB0eShvLnNvdXJjZWdhdGUpIHRoZW4gcmV0dXJuIFtlbXB0eV1cbiAgZWxzZSByZXR1cm4gW2VtcHR5XSAjIG9yIHRocm93P1xuICByZWFkeSA9IFtdXG4gIHdhdGNoID0gW11cblxuICBmb3Igc2cgaW4gby5zb3VyY2VnYXRlXG4gICAgcmVzID0gUi5jbG9uZShlbXB0eSlcbiAgICB1bmxlc3Mgc2cuc291cmNlcz9cbiAgICAgIHNnLnNvdXJjZXMgPSBvLnNvdXJjZWdhdGVSeD9bc2cucmVjaXBlXSB8fCBbXVxuICAgIGVsc2UgdW5sZXNzIFIuaXMoQXJyYXksIHNnLnNvdXJjZXMpXG4gICAgICBzZy5zb3VyY2VzID0gW3NnLnNvdXJjZXNdXG4gICAgc2cub3B0aW9ucyA/PSB7fVxuXG4gICAgdW5sZXNzIHNnLnJlY2lwZT9cbiAgICAgIHJlcyA9IFtzZy5zb3VyY2VzLCBzZy5vcHRpb25zXVxuXG4gICAgZWxzZVxuICAgICAgc291cmNlcyA9IFtdXG4gICAgICBjb25maWcgPSBcIm5vZGVfbW9kdWxlc1wiXG4gICAgICBtb2R1bGUgPSBzZy5tb2R1bGUgfHwgby5zb3VyY2VnYXRlTW9kdWxlXG4gICAgICBwcmVmaXggPSBzZy5wcmVmaXggfHwgby5zb3VyY2VnYXRlUHJlZml4IHx8ICcnXG4gICAgICBwcmVzZXQgPSBzZy5wcmVzZXQgfHwgby5zb3VyY2VnYXRlUHJlc2V0XG4gICAgICBpZiBtb2R1bGVcbiAgICAgICAgc291cmNlcy5wdXNoIGdldFByZXNldChzZy5yZWNpcGUsIHByZXNldCwgbW9kdWxlKSBpZiBwcmVzZXQ/XG4gICAgICAgIGNvbmZpZyA9IHBhdGgubm9ybWFsaXplKFwiI3tjb25maWd9LyN7bW9kdWxlfS8je3ByZWZpeH0je3NnLnJlY2lwZX1yY1wiKVxuICAgICAgICBpZiBmcy5leGlzdHNTeW5jIGNvbmZpZ1xuICAgICAgICAgIGlmIG8uc291cmNlZ2F0ZVdhdGNoXG4gICAgICAgICAgICB3YXRjaC5wdXNoIGNvbmZpZ1xuICAgICAgICAgIHNvdXJjZXMucHVzaCBjb25maWdcbiAgICAgICAgc2cub3B0aW9ucy53cml0ZSA/PSB7fVxuICAgICAgICBzZy5vcHRpb25zLndyaXRlLnBhdGggPSBcIi4je3NnLnJlY2lwZX1yY1wiXG5cbiAgICAgIHJlcyA9IFtzb3VyY2VzLmNvbmNhdChzZy5zb3VyY2VzKSwgc2cub3B0aW9uc11cblxuICAgIHJlYWR5LnB1c2ggcmVzXG5cbiAgaWYgZ3VscD9cbiAgICBndWxwLnRhc2sgXCJzb3VyY2VnYXRlXCIsIFwiV3JpdGUgc291cmNlZ2F0ZSB0YXJnZXRzLlwiLCAtPlxuICAgICAgZm9yIHNnIGluIHJlYWR5XG4gICAgICAgIHNvdXJjZWdhdGUuYXBwbHkobnVsbCwgc2cpXG4gICAgaWYgby5zb3VyY2VnYXRlV2F0Y2hcbiAgICAgIGd1bHAudGFzayBcInNvdXJjZWdhdGU6d2F0Y2hcIixcbiAgICAgICAgXCJXYXRjaCBzb3VyY2VnYXRlIHNvdXJjZXMgZm9yIGNoYW5nZXMuXCIsIC0+XG4gICAgICAgICAgZ3VscC53YXRjaCB3YXRjaCwgW1wic291cmNlZ2F0ZVwiXVxuXG4gIHJlYWR5XG4iXX0=